<!DOCTYPE html>
<html>
	<head>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>上航_车辆预订</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta name="renderer" content="webkit">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		[#AWSImport]
		[#AWSUIImport]
		<link rel='stylesheet' id='schemeCss' href='../apps/_bpm.platform/css/colorschemes/scheme_1.css'  name='schemeCss'/>
	
<link type='text/css' rel='stylesheet' id='themeCss' href='../apps/com.actionsoft.apps.form.theme.antdui/css/theme/theme.css?v=1589851448797' name='themeCss'/>
<link type='text/css' rel='stylesheet' id='themeCss' href='../apps/_bpm.platform/css/theme/theme.css' name='themeCss'/>
</head>
 <style>
  </style>
	<body>
<form id="frmMain" name="frmMain" method="post">
<div id="aws-form-container" class="aws-form-ux-container" border="0">
<table id="aws-form-maintable" class="awsui-ux aws-form-ux-maintable" style="table-layout: auto;" cellspacing="0" cellpadding="0" border="0" align="center">
<tbody>
<tr id="aws-form-titlebg" class="aws-form-ux-titlebg">
<td id="aws-form-title" class="aws-form-ux-header">上航_车辆预订</td>
</tr>
<tr class="aws-form-ux-formcontent" id="aws-form-formcontent">
<td>
<table id="table_container" class="awsui-ux table-striped" style="padding: 0px;" width="100%" cellspacing="3" cellpadding="0"><colgroup><col class="awsui-ux-title" /><col style="width: 50.0%;" /><col class="awsui-ux-title" /><col style="width: 50.0%;" /></colgroup>
<tbody>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="APPLYUNIT">预定单位</label></td>
<td class="aws-form-ux-content">[#APPLYUNIT]</td>
<td class="awsui-ux-title"><label for="APPLYDEPTNAME" class="aws-form-ux-label">预定部门</label></td>
<td class="aws-form-ux-content">[#APPLYDEPTNAME]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="APPLYUSERNAME">预定人</label></td>
<td class="aws-form-ux-content">[#APPLYUSERNAME]</td>
<td class="awsui-ux-title"><label for="APPLYUSERCELLPHONE" class="aws-form-ux-label">预定人手机</label></td>
<td class="aws-form-ux-content">[#APPLYUSERCELLPHONE]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="BDATE">预订开始日期</label></td>
<td class="aws-form-ux-content">[#BDATE]</td>
<td class="awsui-ux-title"><label for="EDATE" class="aws-form-ux-label">预订结束日期</label></td>
<td class="aws-form-ux-content">[#EDATE]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="VEHICLETYPE">车辆类型</label></td>
<td class="aws-form-ux-content">[#VEHICLETYPE]</td>
<td class="awsui-ux-title"><label for="VEHICLENUM" class="aws-form-ux-label">用车数量</label></td>
<td class="aws-form-ux-content">[#VEHICLENUM]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="PERSONNUM">乘坐人数</label></td>
<td class="aws-form-ux-content">[#PERSONNUM]</td>
<td class="awsui-ux-title"><label for="USEREASON" class="aws-form-ux-label">用车事由</label></td>
<td class="aws-form-ux-content">[#USEREASON]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="BOARDINGPLACE">上车地点</label></td>
<td class="aws-form-ux-content">[#BOARDINGPLACE]</td>
<td class="awsui-ux-title"><label for="TARGETPLACE" class="aws-form-ux-label">目的地</label></td>
<td class="aws-form-ux-content">[#TARGETPLACE]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="ISOUTSHANGHAI" flag="labelRequired">是否出省</label></td>
<td class="aws-form-ux-content">[#ISOUTSHANGHAI]</td>
<td class="awsui-ux-title"><label for="ISINTERNALVEHICLE" class="aws-form-ux-label" flag="labelRequired">车辆属性</label></td>
<td class="aws-form-ux-content">[#ISINTERNALVEHICLE]</td>
</tr>
<tr>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="CONTACTPERSON">用车联系人</label></td>
<td class="aws-form-ux-content">[#CONTACTPERSON]</td>
<td class="awsui-ux-title"><label for="CONTACTPHONE" class="aws-form-ux-label">联系人手机</label></td>
<td class="aws-form-ux-content">[#CONTACTPHONE]</td>
</tr>
<tr>
<td class="awsui-ux-title">用车单位</td>
<td class="aws-form-ux-content">[#CONTACTUNIT]</td>
<td class="awsui-ux-title"><label class="aws-form-ux-label" for="REMARK">客户要求</label></td>
<td class="aws-form-ux-content">[#REMARK]</td>
</tr>
<tr id="c8f2f0cd_f7a0_0001_5eab_18661d8e1713">
<td class="awsui-ux-title">联系人部门</td>
<td class="aws-form-ux-content">[#CONTACTDEPT]</td>
<td class="awsui-ux-title"><label id="ISUSECARLabel" class="aws-form-ux-label" for="ISUSECAR">是否用车人</label></td>
<td class="aws-form-ux-content">[#ISUSECAR]</td>
</tr>
<tr>
<td colspan="4" class="aws-form-ux-gridbg">
<div class="aws-form-ux-grid" border="0">[#Grid1]</div>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="aws-form-bottom">
<td class="aws-form-ux-actionsoft">[#Actionsoft]
<div id="hiddenArea" border="0" style="display: none;">[#ORDERID][#APPLYUID][#APPLYDEPTID][#ORDERDATE][#NOTE][#ORDERSTATUS][#CONTACTDEPTID][#APPLYUNITID][#CONTACTPERSONZH][#CONTACTUNITID][#CANCELREASON]</div>
</td>
</tr>
</tbody>
</table>
</div>
</form>
<script src="../commons/js/aws.mobile.jsapi.js"></script>
<script id="formOnload">
function formOnload(){
}
function save(){
	$('#BTN_SAVE').trigger("click");
}
$(function(){
	//往子表的工具栏拼接一个打印按钮
	$("span[group='db']").append("<button type='button' class='button blue' id='DispatchOrderBtn'>派单</button>");
	//点击打印按钮打开打印页面，并传入必要参数
	$("#DispatchOrderBtn").click(function(){
      	debugger;
		//TODO 此处需要修改成车辆任务分配表的表名
		var rjghdGrid = AWSGrid.getGridAPI("BO_EU_SH_VEHICLEORDER_ASSIGMIS");
		var selectRowsDatas = rjghdGrid.getSelectedRowDatas();
		var selectRowsLength =selectRowsDatas.length;
		if( selectRowsLength==0){
			$.simpleAlert("请先勾选需要派单的信息记录！", 'info');
			return;
		}
		var ids = "";//获取子表记录数据信息集合
      	var id = "'";//获取子表记录id集合
		for(var i=0;i< selectRowsLength;i++){
			ids=ids+selectRowsDatas[i].rowData.ID+":"
            	+selectRowsDatas[i].rowData.USECARTYPE+":"
            	+selectRowsDatas[i].rowData.UDATE+":"
           		+selectRowsDatas[i].rowData.VEHICLETYPE+":"
            	+selectRowsDatas[i].rowData.CPH+":"
            	+selectRowsDatas[i].rowData.SJXM+":"
            	+selectRowsDatas[i].rowData.SJZH+":"
            	+selectRowsDatas[i].rowData.SJLXFS+":"
            	+selectRowsDatas[i].rowData.WZUNITPSN+":"
            	+selectRowsDatas[i].rowData.WZUNITPSNZH+":"
            	+selectRowsDatas[i].rowData.WZUNITPSNLXFS+":"
              	+selectRowsDatas[i].rowData.VEHICLELABELNAME+",";
          	id=id+selectRowsDatas[i].rowData.ID+"','";
        }
		ids = ids.substring(0,ids.length-1);
      	id = id.substring(0,id.length-2);
      	//alert(id);
		//var taskInstId = $("#taskInstId").val();
		var processInstId = $("#processInstId").val();
      	var sid = $("#sid").val();
        awsui.ajax.request({
          url: "./jd",
          method: "POST",
          async:true,
          dataType : "json",
          data: {
            sid: sid,
            cmd: "com.awspaas.user.apps.shhtaerospaceindustrial_pdApply",
            processInstId: processInstId,
            ids:ids,
            id:id
          },
          success: function (responseObject) {
            if(responseObject.status == 1){
              alert(responseObject.message);
            }else{//启动成功
              location.reload();
              alert("启动成功！");
            }
          }
        });
	});
 	$("span[group='db']").append("<button type='button' class='button red' id='qxBtn'>取消</button>");
  		//点击打印按钮打开打印页面，并传入必要参数
	$("#qxBtn").click(function(){
		//TODO 此处需要修改成车辆任务分配表的表名
		var rjghdGrid = AWSGrid.getGridAPI("BO_EU_SH_VEHICLEORDER_ASSIGMIS");
		var selectRowsDatas = rjghdGrid.getSelectedRowDatas();
		var selectRowsLength =selectRowsDatas.length;
		if( selectRowsLength==0){
			$.simpleAlert("请先勾选需要取消的信息记录！", 'info');
			return;
		}
		var ids = "";//获取子表记录数据信息集合
      	var id = "'";//获取子表记录id集合
		for(var i=0;i< selectRowsLength;i++){
			ids=ids+selectRowsDatas[i].rowData.ID+":"
            	+selectRowsDatas[i].rowData.USECARTYPE+":"
            	+selectRowsDatas[i].rowData.UDATE+":"
           		+selectRowsDatas[i].rowData.VEHICLETYPE+":"
            	+selectRowsDatas[i].rowData.CPH+":"
            	+selectRowsDatas[i].rowData.SJXM+":"
            	+selectRowsDatas[i].rowData.SJZH+":"
            	+selectRowsDatas[i].rowData.SJLXFS+":"
            	+selectRowsDatas[i].rowData.WZUNITPSN+":"
            	+selectRowsDatas[i].rowData.WZUNITPSNZH+":"
            	+selectRowsDatas[i].rowData.WZUNITPSNLXFS+",";
          	id=id+selectRowsDatas[i].rowData.ID+"','";
        }
		ids = ids.substring(0,ids.length-1);
      	id = id.substring(0,id.length-2);
      	//alert(id);
		//var taskInstId = $("#taskInstId").val();
		var processInstId = $("#processInstId").val();
      	var sid = $("#sid").val();
        awsui.ajax.request({
          url: "./jd",
          method: "POST",
          async:true,
          dataType : "json",
          data: {
            sid: sid,
            cmd: "com.awspaas.user.apps.shhtaerospaceindustrial_qxApply",
            processInstId: processInstId,
            ids:ids,
            id:id
          },
          success: function (responseObject) {
            if(responseObject.status == 1){
              alert(responseObject.message);
            }else{//启动成功
              location.reload();
              alert("取消成功！");
            }
          }
        });
	});
})
</script>
<script id="BO_EU_SH_VEHICLEORDER_ASSIGMIS_load">// <![CDATA[
function BO_EU_SH_VEHICLEORDER_ASSIGMIS_load(dataModel, data){
	$(".aws-grid-cont-inner [pq-col-indx=10]").html('<div class="show-detail" style="width: 80%; background-color: #4596fa; border-radius: 4px; color: #fff; margin: 0x 10%; height: 20px; line-height: 20px; text-align: center;" >查看详情</div>')
	$(".show-detail").on("click",function(){
      	debugger;
      	//console.log($(this));
      	//console.log($(this).parent());
    	var index = $(this).parent().parent().attr("pq-row-indx");
      	var id = AWSGrid.getGridAPI("BO_EU_SH_VEHICLEORDER_ASSIGMIS").getFieldValue(index, "ID");
        var sid = $("#sid").val();
        awsui.ajax.request({
            url: "./jd",
            method: "POST",
            async: false,
            dataType: "json",
            data: {
              sid: sid,
              cmd: "com.awspaas.user.apps.shhtaerospaceindustrial_openForm",
              id: id
            },
            success: function (responseObject) {
              debugger;
              if (responseObject.status == 1) {
                alert(responseObject.message);
              } else {//启动成功
                var url = responseObject.urlPc;
                window.open(url);
                //setTimeout(function(){
                //    $(".mui-btn-task-blue").trigger("click");
                //},0);
                //location.reload();
              }
            }
        });
    });
}
// ]]></script>
</body>
</html>